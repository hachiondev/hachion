<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/Hachion-logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    
    <title>Hachion: Your Learning Partner</title>
    
    <link rel="apple-touch-icon" href="/Hachion-logo.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    
    <script defer src="/static/js/bundle.js"></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TE1LPJJ75K"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-TE1LPJJ75K');
    </script>
  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <script src="https://cdn.botpress.cloud/webchat/v2.3/inject.js"></script>
    <script src="https://files.bpcontent.cloud/2025/04/24/12/20250424124701-H9CXE1T9.js"></script>
<script>
async function getUserDetails() {
  let shouldSkipTracking = false;
  try {
   const isDev = window.location.hostname === "localhost"; 

const res = await fetch("https://api.hachion.co/api/check-ip", {
  method: "POST",
  headers: isDev
    ? { "X-Forwarded-For": "152.57.170.218" } 
    : {}
});
   if (res.status === 403) {
  shouldSkipTracking = true;
}
  } catch (error) {
    console.error("IP check failed", error);
  }

  if (shouldSkipTracking) {
    console.log("IP is blocked from tracking. Skipping ipinfo + webhook.");
    return;
  }
  let ip = 'Unknown';
  let country = 'Unknown';
  let location = 'Unknown';

  try {
    const res = await fetch('https://ipinfo.io/json?token=82aafc3ab8d25b');
    const data = await res.json();
    country = data.country || 'Unknown';
    ip = data.ip || 'Unknown';
    location = `${data.city || 'Unknown'}, ${data.region || 'Unknown'}`;
  } catch (err) {
    console.error("IP info failed", err);
  }

  const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
  const isMobile = /Mobi|Android/i.test(navigator.userAgent);
  const deviceType = isMobile ? "Mobile" : "Desktop";
  const os = getOS();
  const pageUrl = window.location.href;
  const referrer = document.referrer || "Direct Visit";

  const payload = {
    ip,
    country,
    location,
    timezone,
    deviceType,
    os,
    pageUrl,
    referrer,
    timestamp: new Date().toISOString()
  };
    fetch('https://chat.googleapis.com/v1/spaces/AAQAHyjBBRU/messages?key=AIzaSyDdI0hCZtE6vySjMm-WEfRq3CPzqKqqsHI&token=qGzEPAwWY31czsPPpSugSpneD4pEqnWKEnPu-LTqFTA', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text: formatMessage(payload) })
    });
  }

  function getOS() {
    const ua = navigator.userAgent;
    if (ua.includes("Windows NT")) return "Windows";
    if (ua.includes("Mac OS X")) return "macOS";
    if (ua.includes("Linux")) return "Linux";
    if (/Android/.test(ua)) return "Android";
    if (/iPhone|iPad/.test(ua)) return "iOS";
    return "Unknown";
  }

  function formatMessage(data) {
    const dateObj = new Date(data.timestamp);
    const options = {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      hour12: true,
      timeZone: data.timezone
    };
    const formattedDate = dateObj.toLocaleString('en-US', options);

    return `üåê *New Visitor Info*\n
IP: ${data.ip}
Country: ${data.country}
Location: ${data.location}
Timezone: ${data.timezone}
Device: ${data.deviceType}
OS: ${data.os}
Visited Page: ${data.pageUrl}
Referral Source: ${data.referrer}
Visited at: ${formattedDate}`;
  }

  window.addEventListener('load', getUserDetails);
</script>
  </body>
</html>