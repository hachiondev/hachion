<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Hachion: Your Learning Partner</title>
  <link rel="icon" href="/Hachion-logo.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <link rel="apple-touch-icon" href="/Hachion-logo.png" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script defer src="/static/js/bundle.js"></script>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TE1LPJJ75K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-TE1LPJJ75K');
  </script>
</head>
<body>
  <div id="root"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.botpress.cloud/webchat/v2.3/inject.js"></script>
  <script src="https://files.bpcontent.cloud/2025/04/24/12/20250424124701-H9CXE1T9.js"></script>
<script>
  async function reverseGeocode(lat, lon) {
    try {
      const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
      const data = await res.json();
      const address = data.address;
      const city = address.city || address.town || address.village || 'Unknown City';
      const state = address.state || 'Unknown State';
      return { city, state };
    } catch (error) {
      console.error("Reverse geocoding failed:", error);
      return { city: "Unknown", state: "Unknown" };
    }
  }

  async function getUserDetails() {
    let ip = 'Unknown';
    let country = 'Unknown';
    let city = 'Unknown';
    let state = 'Unknown';

    const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
    const pageUrl = window.location.href;

    const referrer = (() => {
      try {
        const refUrl = document.referrer;
        if (refUrl) {
          const hostname = new URL(refUrl).hostname.replace('www.', '');
          const base = hostname.split('.')[0];
          return base.charAt(0).toUpperCase() + base.slice(1);
        }
      } catch (e) {
        console.warn("Error parsing referrer", e);
      }
      return 'Direct';
    })();

    const sendPayloadIfRequired = async () => {
      if (state.toLowerCase().includes("puducherry") || city.toLowerCase() === "yanam") {
        const payload = {
          ip,
          country,
          location: `${city}, ${state}`,
          timezone,
          pageUrl,
          referrer,
          timestamp: new Date().toISOString()
        };
        sendToGoogleChat(payload);
      } else {
        console.log("User not from Puducherry or Yanam ‚Äî payload not sent.");
      }
    };

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async (position) => {
  const lat = position.coords.latitude;
  const lon = position.coords.longitude;

  
  try {
    const ipRes = await fetch('https://ipwho.is/');
    const ipData = await ipRes.json();
    if (ipData.success !== false) {
      ip = ipData.ip || 'Unknown';
      country = ipData.country || 'Unknown';
    }
  } catch (e) {
    console.warn("IP fetch failed:", e);
  }

  const loc = await reverseGeocode(lat, lon);
  city = loc.city;
  state = loc.state;
  sendPayloadIfRequired();

      });
    } else {
      console.warn("Geolocation not supported, using IP fallback");
      const res = await fetch('https://ipwho.is/');
      const data = await res.json();
      if (data.success !== false) {
        ip = data.ip || 'Unknown';
        country = data.country || 'Unknown';
        const loc = await reverseGeocode(data.latitude, data.longitude);
        city = loc.city;
        state = loc.state;
      }
      sendPayloadIfRequired();
    }
  }

  function formatMessage(data) {
    const dateObj = new Date(data.timestamp);
    const options = {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      hour12: true,
      timeZone: data.timezone
    };
    const formattedDate = dateObj.toLocaleString('en-US', options);

    return `üåê *New Visitor Info*\n
*IP:* ${data.ip}
*Country:* ${data.country}
*User Location:* ${data.location}
*Timezone:* ${data.timezone}
*Visited Page:* ${data.pageUrl}
*Referral Source:* ${data.referrer}
*Visited at:* ${formattedDate}`;
  }

  function sendToGoogleChat(payload) {
    fetch('https://chat.googleapis.com/v1/spaces/AAQAHyjBBRU/messages?key=AIzaSyDdI0hCZtE6vySjMm-WEfRq3CPzqKqqsHI&token=qGzEPAwWY31czsPPpSugSpneD4pEqnWKEnPu-LTqFTA', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text: formatMessage(payload) })
    });
  }

  window.addEventListener('load', getUserDetails);
</script>


  <noscript>You need to enable JavaScript to run this app.</noscript>
</body>
</html>