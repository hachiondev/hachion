<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/Hachion-logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <title>Hachion: Your Learning Partner</title>

    <!-- iOS icon -->
    <link rel="apple-touch-icon" href="/Hachion-logo.png" />

    <!-- ‚úÖ Preconnects for LCP/CDN performance -->
    <link rel="preconnect" href="https://cdn.botpress.cloud" />
    <link rel="preconnect" href="https://webchat.botpress.cloud" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- ‚úÖ Preload your critical LCP image (adjust URL as needed) -->
    <link rel="preload" as="image" href="/static/media/qa-video.c927978d2dd8f6f77413.png" fetchpriority="high" />

    <!-- ‚úÖ Lazy-load Bootstrap CSS (non-blocking) -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      media="print"
      onload="this.media='all'"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <noscript>
      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      />
    </noscript>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TE1LPJJ75K"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'G-TE1LPJJ75K', { debug_mode: true });
    </script>
  </head>

  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <!-- ‚úÖ Defer Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      defer
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <!-- ‚úÖ Defer Botpress Scripts -->
    <script src="https://cdn.botpress.cloud/webchat/v2.3/inject.js" defer></script>
    <script src="https://files.bpcontent.cloud/2025/04/24/12/20250424124701-H9CXE1T9.js" defer></script>

    <!-- ‚úÖ IP/Visitor Tracking Script -->
    <script>
      async function getUserDetails() {
        let shouldSkipTracking = false;
        try {
          const isDev = window.location.hostname === "localhost";
          const res = await fetch("https://api.hachion.co/api/check-ip", {
            method: "POST",
            headers: isDev ? { "X-Forwarded-For": "152.57.170.218" } : {}
          });
          if (res.status === 403) shouldSkipTracking = true;
        } catch (error) {
          console.error("IP check failed", error);
        }

        if (shouldSkipTracking) {
          console.log("IP is blocked from tracking. Skipping ipinfo + webhook.");
          return;
        }

        let ip = 'Unknown', country = 'Unknown', location = 'Unknown';
        try {
          const res = await fetch('https://ipinfo.io/json?token=82aafc3ab8d25b');
          const data = await res.json();
          country = data.country || 'Unknown';
          ip = data.ip || 'Unknown';
          location = `${data.city || 'Unknown'}, ${data.region || 'Unknown'}`;
        } catch (err) {
          console.error("IP info failed", err);
        }

        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        const isMobile = /Mobi|Android/i.test(navigator.userAgent);
        const deviceType = isMobile ? "Mobile" : "Desktop";
        const os = getOS();
        const pageUrl = window.location.href;
        const referrer = document.referrer || "Direct Visit";

        const payload = {
          ip,
          country,
          location,
          timezone,
          deviceType,
          os,
          pageUrl,
          referrer,
          timestamp: new Date().toISOString()
        };

        try {
          await fetch(
            'https://chat.googleapis.com/v1/spaces/AAQAHyjBBRU/messages?key=AIzaSyDdI0hCZtE6vySjMm-WEfRq3CPzqKqqsHI&token=qGzEPAwWY31czsPPpSugSpneD4pEqnWKEnPu-LTqFTA',
            {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ text: formatMessage(payload) })
            }
          );
        } catch (error) {
          console.warn("Google Chat webhook failed:", error);
        }
      }

      function getOS() {
        const ua = navigator.userAgent;
        if (ua.includes("Windows NT")) return "Windows";
        if (ua.includes("Mac OS X")) return "macOS";
        if (ua.includes("Linux")) return "Linux";
        if (/Android/.test(ua)) return "Android";
        if (/iPhone|iPad/.test(ua)) return "iOS";
        return "Unknown";
      }

      function formatMessage(data) {
        const dateObj = new Date(data.timestamp);
        const options = {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          hour12: true,
          timeZone: data.timezone
        };
        const formattedDate = dateObj.toLocaleString('en-US', options);
        return `üåê New Visitor Info\n
IP: ${data.ip}
Country: ${data.country}
Location: ${data.location}
Timezone: ${data.timezone}
Device: ${data.deviceType}
OS: ${data.os}
Visited Page: ${data.pageUrl}
Referral Source: ${data.referrer}
Visited at: ${formattedDate}`;
      }

      window.addEventListener('load', getUserDetails);
    </script>
  </body>
</html>